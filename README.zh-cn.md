# vue-page-stack

<p align="center">
  <svg width="200" viewBox="0 0 327.31497027104996 221.87499999999997" class="looka-1j8o68f">
         <defs id="SvgjsDefs1620">
            <linearGradient id="SvgjsLinearGradient1627">
              <stop id="SvgjsStop1628" stop-color="#7f00ff" offset="0"></stop>
              <stop id="SvgjsStop1629" stop-color="#e100ff" offset="1"></stop>
            </linearGradient>
            <linearGradient id="SvgjsLinearGradient1630">
              <stop id="SvgjsStop1631" stop-color="#7f00ff" offset="0"></stop>
              <stop id="SvgjsStop1632" stop-color="#e100ff" offset="1"></stop>
            </linearGradient>
            <linearGradient id="SvgjsLinearGradient1633">
              <stop id="SvgjsStop1634" stop-color="#7f00ff" offset="0"></stop>
              <stop id="SvgjsStop1635" stop-color="#e100ff" offset="1"></stop>
            </linearGradient>
          </defs>
          <g
            id="SvgjsG1622"
            featurekey="symbolFeature-0"
            transform="matrix(1.4392189553564954,0,0,1.4392189553564954,92.03904948708293,2.2474866792680075)"
            fill="url(#SvgjsLinearGradient1630)"
          >
            <path
              xmlns="http://www.w3.org/2000/svg"
              d="M22.53,38.82,49.8,50.46a.5.5,0,0,0,.39,0L77.47,38.82a.5.5,0,0,0,0-.92L50.2,26.27a.51.51,0,0,0-.39,0L22.53,37.9a.5.5,0,0,0,0,.92ZM50,27.27,76,38.36,50,49.46,24,38.36Z"
            ></path>
            <path
              xmlns="http://www.w3.org/2000/svg"
              d="M77.08,61.18,50,72.73,22.92,61.18a.5.5,0,1,0-.39.92L49.8,73.73a.5.5,0,0,0,.39,0L77.47,62.1a.5.5,0,1,0-.39-.92Z"
            ></path>
            <path
              xmlns="http://www.w3.org/2000/svg"
              d="M77.08,49.54,50,61.09,22.92,49.54a.5.5,0,0,0-.39.92L49.8,62.1a.5.5,0,0,0,.39,0L77.47,50.46a.5.5,0,1,0-.39-.92Z"
            ></path>
          </g>
          <g
            id="SvgjsG1623"
            featurekey="nameFeature-0"
            transform="matrix(1.8679716093169987,0,0,1.8679716093169987,61.833154108940406,106.63040557324561)"
            fill="url(#SvgjsLinearGradient1633)"
          >
            <path
              d="M10.64 18.76 c2.7733 0 4.94 0.56004 6.5 1.68 s2.4333 2.76 2.62 4.92 l-5.4 0 c-0.08 -0.98668 -0.44 -1.7 -1.08 -2.14 s-1.5733 -0.66 -2.8 -0.66 c-1.0667 0 -1.86 0.16 -2.38 0.48 s-0.78 0.8 -0.78 1.44 c0 0.48 0.17332 0.88 0.52 1.2 s0.87336 0.6 1.58 0.84 s1.4867 0.44 2.34 0.6 c2.5867 0.50668 4.4132 1.0267 5.48 1.56 s1.8467 1.1733 2.34 1.92 s0.74 1.6667 0.74 2.76 c0 2.32 -0.84668 4.1 -2.54 5.34 s-3.9933 1.86 -6.9 1.86 c-3.04 0 -5.4068 -0.65332 -7.1 -1.96 s-2.5666 -3.08 -2.62 -5.32 l5.4 0 c0 1.0667 0.41332 1.9134 1.24 2.54 s1.8667 0.94 3.12 0.94 c1.0667 0 1.9534 -0.23332 2.66 -0.7 s1.06 -1.1134 1.06 -1.94 c0 -0.53332 -0.22 -0.97332 -0.66 -1.32 s-1.06 -0.65336 -1.86 -0.92004 s-2.04 -0.57336 -3.72 -0.92004 c-1.3333 -0.26668 -2.52 -0.62668 -3.56 -1.08 s-1.8333 -1.0466 -2.38 -1.78 s-0.82 -1.6333 -0.82 -2.7 c0 -1.36 0.32668 -2.5467 0.98 -3.56 s1.6533 -1.78 3 -2.3 s3.02 -0.78 5.02 -0.78 z M31.747 13.120000000000001 l0.000039062 6.2 l4.16 0 l0 3.8 l-4.16 0 l0 10.24 c0 0.96 0.16 1.6 0.48 1.92 s0.96 0.48 1.92 0.48 c0.69332 0 1.28 -0.05332 1.76 -0.16 l0 4.44 c-0.8 0.13332 -1.92 0.2 -3.36 0.2 c-2.1867 0 -3.8134 -0.37332 -4.88 -1.12 s-1.6 -2.04 -1.6 -3.88 l0 -12.12 l-3.44 0 l0 -3.8 l3.44 0 l0 -6.2 l5.68 0 z M49.054 18.76 c6.0268 0.02668 9.04 1.9866 9.04 5.88 l0 10.96 c0 2.0267 0.24 3.4934 0.72 4.4 l-5.76 0 c-0.21332 -0.64 -0.34664 -1.3067 -0.39996 -2 c-1.68 1.7067 -4 2.56 -6.96 2.56 c-2.16 0 -3.8733 -0.54668 -5.14 -1.64 s-1.9 -2.6133 -1.9 -4.56 c0 -1.8933 0.6 -3.36 1.8 -4.4 c1.2267 -1.0933 3.4534 -1.7866 6.68 -2.08 c2.2933 -0.24 3.7466 -0.54 4.36 -0.9 s0.92 -0.91332 0.92 -1.66 c0 -0.93332 -0.28 -1.6266 -0.84 -2.08 s-1.4933 -0.68 -2.8 -0.68 c-1.2 0 -2.1067 0.24668 -2.72 0.74 s-0.97332 1.2866 -1.08 2.38 l-5.68 0 c0.13332 -2.2667 1.0666 -3.9867 2.8 -5.16 s4.0532 -1.76 6.96 -1.76 z M44.334 34.12 c0 1.76 1.16 2.64 3.48 2.64 c3.04 -0.02668 4.5732 -1.5867 4.6 -4.68 l0 -2.2 c-0.45332 0.45332 -1.6 0.78664 -3.44 0.99996 c-1.6 0.18668 -2.7733 0.51336 -3.52 0.98004 s-1.12 1.22 -1.12 2.26 z M73.321 18.76 c2.8 0 5.08 0.71328 6.84 2.14 s2.72 3.3267 2.88 5.7 l-5.56 0 c-0.37332 -2.3733 -1.7733 -3.56 -4.2 -3.56 c-1.4933 0 -2.6733 0.61332 -3.54 1.84 s-1.3 2.8534 -1.3 4.88 c0 1.9467 0.41332 3.52 1.24 4.72 s1.9867 1.8 3.48 1.8 c2.5867 0 4.0932 -1.4 4.52 -4.2 l5.48 0 c-0.37332 2.7467 -1.4333 4.8468 -3.18 6.3 s-4.0068 2.18 -6.78 2.18 c-3.0667 0 -5.5732 -0.98 -7.52 -2.94 s-2.92 -4.5132 -2.92 -7.66 c0 -3.4133 0.96 -6.1332 2.88 -8.16 s4.48 -3.04 7.68 -3.04 z M93.468 11.440000000000001 l0 15.32 l7.16 -7.44 l6.72 0 l-7.8 7.6 l8.68 13.08 l-6.88 0 l-5.68 -9.24 l-2.2 2.12 l0 7.12 l-5.68 0 l0 -28.56 l5.68 0 z"
            ></path>
          </g>
  </svg>
</p>

<p align="center">
  <a href="https://www.npmjs.com/package/vue-page-stack">
    <img src="https://img.shields.io/npm/dt/vue-page-stack.svg" alt="Downloads">
  </a>
  <a href="https://www.npmjs.com/package/vue-page-stack">
    <img src="https://img.shields.io/npm/dm/vue-page-stack.svg" alt="Downloads">
  </a>
  <br>
  <a href="https://github.com/hezhongfeng/vue-page-stack/blob/master/LICENSE.md">
    <img src="https://img.shields.io/npm/l/vue-page-stack.svg" alt="License">
  </a>
  <a href="https://www.npmjs.com/package/vue-page-stack">
    <img src="https://img.shields.io/npm/v/vue-page-stack.svg" alt="Version">
  </a>
</p>


## 3.1.4

1. 修复刷新浏览器然后后退的 bug

## v3.1.3

1. 修复 replace 时，页面缓存问题

## v3.1.2

1. 移除了 url 上的参数 `stack-key`
2. 因为 Vue3.x 对内置组件有特殊处理，所以目前不能和 `Transition` 一起使用

**这个是 Vue3.x 的版本 ，Vue2.0 请点击[这个链接](https://github.com/hezhongfeng/vue-page-stack/tree/v1.5.0)**

[English](./README.md) | 简体中文

---

Vue3 单页应用导航管理器，像原生 app 一样管理页面栈而不是销毁。

<div align="center">
  <img src="https://raw.githubusercontent.com/hezhongfeng/images/master/vue-page-stack.gif">
</div>

## Example

[预览](http://vue-page-stack-example.vercel.app/)

[示例源码](https://github.com/hezhongfeng/vue-page-stack-example)

## 功能特性

- 🐉 在 vue-router 上扩展，原有导航逻辑不变
- ⚽`push`或者`forward`的时候重新渲染页面，Stack 中会存储新渲染的页面
- 🏆`back`或者`go(负数)`的时候先前的页面不会重新渲染，而是从 Stack 中读取，并且这些页面保留着先前的内容状态，例如表单内容，滚动条滚动的位置等
- 🏈`back`或者`go(负数)`的时候会把不用的页面从 Stack 中移除
- 🎓`replace`会更新 Stack 中当前页面
- 🎉 回退到之前页面的时候有 activated 钩子函数触发
- 🚀 支持浏览器的后退，前进事件
- 🐰 提供路由方向的变化，并且可以在前进和后退的时候添加不同的动画

## 和 KeepAlive 的区别

- 🌱 VuePageStack 不提供 `include` `exclude` 和 `max` 参数，因为 VuePageStack 想要实现的是一个完整的页面栈管理，只能按照顺序进出
- 🪁 KeepAlive 缓存过页面之后会一直缓存这个页面，VuePageStack 会根据页面栈的层级而自助销毁多余的页面
- 🧬 KeepAlive 进入（不是返回）相同的路由页面，会继续复用以前缓存的页面，而 VuePageStack 会重新渲染页面

## 安装和用法

### 安装

```js
pnpm install vue-page-stack
```

### 使用

```js
import { createApp } from 'vue';
import { VuePageStackPlugin } from 'vue-page-stack';

const app = createApp(App);

// router is necessary
app.use(VuePageStackPlugin, { router });
```

```vue
// App.vue
<template>
  <router-view v-slot="{ Component }">
    <vue-page-stack @back="onBack" @forward="onForward">
      <component :is="Component" :key="$route.fullPath"></component>
    </vue-page-stack>
  </router-view>
</template>

<script setup>
const onBack = () => {
  console.log('back');
};

const onForward = () => {
  console.log('forward');
};
</script>
```

## API

### 注册插件

使用之前需要注册插件

```js
import { VuePageStackPlugin } from 'vue-page-stack';

//...
app.use(VuePageStackPlugin, { router });
```

Options 说明：

| Attribute | Description         | Type   | Accepted Values     | Default        |
| --------- | ------------------- | ------ | ------------------- | -------------- |
| router    | vue-router instance | Object | vue-router instance | -              |

### 前进和后退

如果想在页面前进或者后退的时候添加一些事件，可以通过组件的 `back` 事件和 `forward` 事件进行处理

```vue
// App.vue
<template>
  <router-view v-slot="{ Component }">
    <vue-page-stack @back="onBack" @forward="onForward">
      <component :is="Component" :key="$route.fullPath"></component>
    </vue-page-stack>
  </router-view>
</template>

<script setup>
const onBack = () => {
  console.log('back');
};

const onForward = () => {
  console.log('forward');
};
</script>
```

[example](https://github.com/hezhongfeng/vue-page-stack-example/blob/master/src/App.vue)

## 相关说明

### 更新日志

主要的更新日志在 [release notes](https://github.com/hezhongfeng/vue-page-stack/releases)

### 原理

获取当前页面实例部分参考了`Vue`源码中`KeepAlive`的部分

## 感谢

这个插件同时借鉴了[vue-navigation](https://github.com/zack24q/vue-navigation)和[vue-nav](https://github.com/nearspears/vue-nav)，很感谢他们给的灵感。

## Contributors ✨

Thanks goes to these wonderful people ([emoji key](https://allcontributors.org/docs/en/emoji-key)):

<table>
  <tr>
    <td align="center"><a href="http://hezf.online"><img src="https://avatars2.githubusercontent.com/u/12163050?v=4" width="100px;" alt="hezf"/><br /><sub><b>hezf</b></sub></a><br /><a href="#design-hezhongfeng" title="Design">🎨</a></td>
    <td align="center"><a href="https://github.com/woshilina"><img src="https://avatars0.githubusercontent.com/u/28744945?v=4" width="100px;" alt="李娜"/><br /><sub><b>李娜</b></sub></a><br /><a href="https://github.com/hezhongfeng/vue-page-stack/commits?author=woshilina" title="Documentation">📖</a></td>
    <td align="center"><a href="https://github.com/yuxiaolei1989"><img src="https://avatars0.githubusercontent.com/u/7732447?v=4" width="100px;" alt="余小磊"/><br /><sub><b>余小磊</b></sub></a><br /><a href="https://github.com/hezhongfeng/vue-page-stack/commits?author=yuxiaolei1989" title="Code">💻</a></td>
    <td align="center"><a href="https://github.com/yellowbeee"><img src="https://avatars0.githubusercontent.com/u/16685984?v=4" width="100px;" alt="yellowbeee"/><br /><sub><b>yellowbeee</b></sub></a><br /><a href="https://github.com/hezhongfeng/vue-page-stack/commits?author=yellowbeee" title="Code">💻</a></td>
  </tr>
</table>
