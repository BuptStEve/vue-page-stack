var VuePageStack=function(E,m){"use strict";const C={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"};console.log(m.useRoute);var i;(function(e){e[e.ELEMENT=1]="ELEMENT",e[e.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",e[e.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",e[e.TEXT_CHILDREN=8]="TEXT_CHILDREN",e[e.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",e[e.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",e[e.TELEPORT=64]="TELEPORT",e[e.SUSPENSE=128]="SUSPENSE",e[e.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",e[e.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE",e[e.COMPONENT=6]="COMPONENT"})(i||(i={}));const A=(e,o)=>{for(let s=0;s<e.length;s++)e[s](o)};function V(e,o,s,t){E.callWithAsyncErrorHandling(e,o,h.VNODE_HOOK,[s,t])}const S=e=>e.__isSuspense,g={ENTER:0,LEAVE:1,REORDER:2},h={SETUP_FUNCTION:0,RENDER_FUNCTION:1,WATCH_GETTER:2,WATCH_CALLBACK:3,WATCH_CLEANUP:4,NATIVE_EVENT_HANDLER:5,COMPONENT_EVENT_HANDLER:6,VNODE_HOOK:7};function U(e){e.shapeFlag&=~i.COMPONENT_SHOULD_KEEP_ALIVE,e.shapeFlag&=~i.COMPONENT_KEPT_ALIVE}function p(e){return e.shapeFlag&i.SUSPENSE?e.ssContent:e}const u=[],R=e=>{for(let o=0;o<u.length;o++)if(u[o].key===e)return o;return-1},x=e=>E.defineComponent({name:C.componentName,__isKeepAlive:!0,setup(o,{slots:s}){console.log("VuePageStack setup",e);const t=E.getCurrentInstance(),r=t.ctx,O=t.suspense,{renderer:{p:f,m:H,um:D,o:{createElement:k}}}=r,K=k("div");r.activate=(n,l,T,a,c)=>{const N=n.component;H(n,l,T,g.ENTER,O),f(N.vnode,n,l,T,N,O,a,n.slotScopeIds,c),E.queuePostFlushCb(()=>{N.isDeactivated=!1,N.a&&A(N.a);const P=n.props&&n.props.onVnodeMounted;P&&V(P,N.parent,n)},O)},r.deactivate=n=>{const l=n.component;H(n,K,null,g.LEAVE,O),E.queuePostFlushCb(()=>{l.da&&A(l.da);const T=n.props&&n.props.onVnodeUnmounted;T&&V(T,l.parent,n),l.isDeactivated=!0},O)};function b(n){U(n),D(n,t,O,!0)}let _=null,d=!1;const M=()=>{console.log("cacheSubtree"),_!=null&&(d?u[u.length-1].vnode=p(t.subTree):u.push({key:_,vnode:p(t.subTree)})),console.log(_,u)};return E.onMounted(M),E.onUpdated(M),E.onBeforeUnmount(()=>{for(const n of u)b(n.vnode)}),()=>{console.log("return"),_=null,d=!1;const n=m.useRoute();console.log(n);const l=n.query[e];if(!s.default)return null;console.log(180);const T=s.default(),a=T[0];if(T.length>1)return T;if(!E.isVNode(a)||!(a.shapeFlag&i.STATEFUL_COMPONENT)&&!(a.shapeFlag&i.SUSPENSE))return a;console.log(191);let c=p(a);c.el&&(c=E.cloneVNode(c),a.shapeFlag&i.SUSPENSE&&(a.ssContent=c)),_=l,console.log("pendingCacheKey",_);let N=R(l);if(N!==-1){const P=u[N].vnode;c.el=P.el,c.component=P.component,c.transition&&E.setTransitionHooks(c,c.transition),c.shapeFlag|=i.COMPONENT_KEPT_ALIVE;for(let L=N+1;L<u.length;L++)u[L]=null;u.splice(N+1),d=!0}return c.shapeFlag|=i.COMPONENT_SHOULD_KEEP_ALIVE,S(a.type)?a:c}}});function I(e,o){return!!e[o]}function y(e){return e.replace(/[xy]/g,o=>{const s=Math.random()*16|0;return(o==="x"?s:s&3|8).toString(16)})}return{install(e,{router:o,name:s=C.componentName,keyName:t=C.keyName}){if(!o)throw Error(`
 vue-router is necessary. 

`);e.component(s,x(t)),o.beforeEach((r,O)=>{if(console.log("beforeEach"),I(r.query,t))R(r.query[t])===-1?(r.params[t+"-dir"]=C.forwardName,console.log("前进")):(r.params[t+"-dir"]=C.backName,console.log("后退"));else{r.query[t]=y("xxxxxxxx");const f=!I(O.query,t);return{hash:r.hash,path:r.path,name:r.name,params:r.params,query:r.query,meta:r.meta,replace:f}}})}}}(Vue,vueRouter);
//# sourceMappingURL=vue-page-stack.iife.js.map
