var VuePageStack=function(s){"use strict";const N={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"},m={action:N.pushName};let O;const D=new Uint8Array(16);function h(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(D)}const r=[];for(let n=0;n<256;++n)r.push((n+256).toString(16).slice(1));function H(n,e=0){return r[n[e+0]]+r[n[e+1]]+r[n[e+2]]+r[n[e+3]]+"-"+r[n[e+4]]+r[n[e+5]]+"-"+r[n[e+6]]+r[n[e+7]]+"-"+r[n[e+8]]+r[n[e+9]]+"-"+r[n[e+10]]+r[n[e+11]]+r[n[e+12]]+r[n[e+13]]+r[n[e+14]]+r[n[e+15]]}const U={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function S(n,e,c){if(U.randomUUID&&!e&&!n)return U.randomUUID();n=n||{};const o=n.random||(n.rng||h)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){c=c||0;for(let E=0;E<16;++E)e[c+E]=o[E];return e}return H(o)}var u;(function(n){n[n.ELEMENT=1]="ELEMENT",n[n.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",n[n.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",n[n.TEXT_CHILDREN=8]="TEXT_CHILDREN",n[n.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",n[n.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",n[n.TELEPORT=64]="TELEPORT",n[n.SUSPENSE=128]="SUSPENSE",n[n.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",n[n.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE",n[n.COMPONENT=6]="COMPONENT"})(u||(u={}));const A=(n,e)=>{for(let c=0;c<n.length;c++)n[c](e)};function V(n,e,c,o){s.callWithAsyncErrorHandling(n,e,M.VNODE_HOOK,[c,o])}const f=n=>n.__isSuspense,b={ENTER:0,LEAVE:1,REORDER:2},M={SETUP_FUNCTION:0,RENDER_FUNCTION:1,WATCH_GETTER:2,WATCH_CALLBACK:3,WATCH_CLEANUP:4,NATIVE_EVENT_HANDLER:5,COMPONENT_EVENT_HANDLER:6,VNODE_HOOK:7};function y(n){n.shapeFlag&=~u.COMPONENT_SHOULD_KEEP_ALIVE,n.shapeFlag&=~u.COMPONENT_KEPT_ALIVE}function P(n){return n.shapeFlag&u.SUSPENSE?n.ssContent:n}const T=[],w=n=>s.defineComponent({name:N.componentName,__isKeepAlive:!0,setup(e,{slots:c}){const o=s.getCurrentInstance(),E=o.ctx,l=o.suspense,{renderer:{p,m:C,um:q,o:{createElement:v}}}=E,B=v("div");E.activate=(t,i,a,L,_)=>{const d=t.component;C(t,i,a,b.ENTER,l),p(d.vnode,t,i,a,d,l,L,t.slotScopeIds,_),s.queuePostFlushCb(()=>{d.isDeactivated=!1,d.a&&A(d.a);const g=t.props&&t.props.onVnodeMounted;g&&V(g,d.parent,t)},l)},E.deactivate=t=>{const i=t.component;C(t,B,null,b.LEAVE,l),s.queuePostFlushCb(()=>{i.da&&A(i.da);const a=t.props&&t.props.onVnodeUnmounted;a&&V(a,i.parent,t),i.isDeactivated=!0},l)};function G(t){y(t),q(t,o,l,!0)}let I=null,k=!1;const R=()=>{I&&(k?T[T.length-1].vnode=P(o.subTree):(console.log("cacheSubtree and push"),T.push({vnode:P(o.subTree)}),console.log(T)))};return s.onMounted(R),s.onUpdated(R),s.onBeforeUnmount(()=>{for(const t of T)G(t.vnode)}),()=>{if(k=!1,!c.default)return null;const t=c.default(),i=t[0];if(t.length>1)return t;if(!s.isVNode(i)||!(i.shapeFlag&u.STATEFUL_COMPONENT)&&!(i.shapeFlag&u.SUSPENSE))return i;let a=P(i);console.log("vnode.key",a.key);const L=S();if(a.el&&(a=s.cloneVNode(a),i.shapeFlag&u.SUSPENSE&&(i.ssContent=a)),I=L,m.action===N.backName){console.log("back");let _=T.pop();const d=T[T.length-1].vnode;a.el=d.el,a.component=d.component,a.transition&&s.setTransitionHooks(a,a.transition),a.shapeFlag|=u.COMPONENT_KEPT_ALIVE,y(_.vnode),_=null,k=!0}return a.shapeFlag|=u.COMPONENT_SHOULD_KEEP_ALIVE,f(i.type)?i:a}}}),K=n=>{const e=n.push.bind(n),c=n.go.bind(n),o=n.replace.bind(n),E=n.back.bind(n),l=n.forward.bind(n);n.push=p=>(m.action=N.pushName,e(p)),n.go=p=>{m.action=N.goName,c(p)},n.replace=p=>(m.action=N.replaceName,o(p)),n.back=()=>{m.action=N.backName,E()},n.forward=()=>{m.action=N.forwardName,l()}},x={install(n,{router:e,backCallback:c,forwardCallback:o}={router:null,backCallback:null,forwardCallback:null}){if(!e)throw Error("router is required");let E=null;e.options.history.listen((l,p,C)=>{E=C}),e.beforeEach(()=>{E&&(E.direction==="back"&&c?c():E.direction==="forward"&&o&&o(),E=null)})}},W=()=>{m.action=N.backName};return{install(n,{router:e,name:c=N.componentName,keyName:o=N.keyName}){if(!e)throw Error(`
 vue-router is necessary. 

`);n.component(c,w()),n.use(x,{router:e,backCallback:W}),K(e)}}}(Vue);
