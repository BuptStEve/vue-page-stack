"use strict";const E=require("vue");require("vue-router");const u={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"},O={action:u.pushName};let _;const S=new Uint8Array(16);function f(){if(!_&&(_=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(S)}const i=[];for(let n=0;n<256;++n)i.push((n+256).toString(16).slice(1));function w(n,e=0){return i[n[e+0]]+i[n[e+1]]+i[n[e+2]]+i[n[e+3]]+"-"+i[n[e+4]]+i[n[e+5]]+"-"+i[n[e+6]]+i[n[e+7]]+"-"+i[n[e+8]]+i[n[e+9]]+"-"+i[n[e+10]]+i[n[e+11]]+i[n[e+12]]+i[n[e+13]]+i[n[e+14]]+i[n[e+15]]}const v=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),y={randomUUID:v};function K(n,e,c){if(y.randomUUID&&!e&&!n)return y.randomUUID();n=n||{};const o=n.random||(n.rng||f)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){c=c||0;for(let s=0;s<16;++s)e[c+s]=o[s];return e}return w(o)}var N;(function(n){n[n.ELEMENT=1]="ELEMENT",n[n.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",n[n.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",n[n.TEXT_CHILDREN=8]="TEXT_CHILDREN",n[n.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",n[n.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",n[n.TELEPORT=64]="TELEPORT",n[n.SUSPENSE=128]="SUSPENSE",n[n.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",n[n.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE",n[n.COMPONENT=6]="COMPONENT"})(N||(N={}));const V=(n,e)=>{for(let c=0;c<n.length;c++)n[c](e)};function R(n,e,c,o){E.callWithAsyncErrorHandling(n,e,q.VNODE_HOOK,[c,o])}const x=n=>n.__isSuspense,I={ENTER:0,LEAVE:1,REORDER:2},q={SETUP_FUNCTION:0,RENDER_FUNCTION:1,WATCH_GETTER:2,WATCH_CALLBACK:3,WATCH_CLEANUP:4,NATIVE_EVENT_HANDLER:5,COMPONENT_EVENT_HANDLER:6,VNODE_HOOK:7};function g(n){n.shapeFlag&=~N.COMPONENT_SHOULD_KEEP_ALIVE,n.shapeFlag&=~N.COMPONENT_KEPT_ALIVE}function L(n){return n.shapeFlag&N.SUSPENSE?n.ssContent:n}const p=[],W=n=>E.defineComponent({name:u.componentName,__isKeepAlive:!0,setup(e,{slots:c}){const o=E.getCurrentInstance(),s=o.ctx,l=o.suspense,{renderer:{p:T,m,um:h,o:{createElement:D}}}=s,H=D("div");s.activate=(t,r,a,k,C)=>{const d=t.component;m(t,r,a,I.ENTER,l),T(d.vnode,t,r,a,d,l,k,t.slotScopeIds,C),E.queuePostFlushCb(()=>{d.isDeactivated=!1,d.a&&V(d.a);const b=t.props&&t.props.onVnodeMounted;b&&R(b,d.parent,t)},l)},s.deactivate=t=>{const r=t.component;m(t,H,null,I.LEAVE,l),E.queuePostFlushCb(()=>{r.da&&V(r.da);const a=t.props&&t.props.onVnodeUnmounted;a&&R(a,r.parent,t),r.isDeactivated=!0},l)};function M(t){g(t),h(t,o,l,!0)}let A=null,P=!1;const U=()=>{A&&(P?p[p.length-1].vnode=L(o.subTree):(console.log("cacheSubtree and push"),p.push({vnode:L(o.subTree)}),console.log(p)))};return E.onMounted(U),E.onUpdated(U),E.onBeforeUnmount(()=>{for(const t of p)M(t.vnode)}),()=>{if(P=!1,!c.default)return null;const t=c.default(),r=t[0];if(t.length>1)return t;if(!E.isVNode(r)||!(r.shapeFlag&N.STATEFUL_COMPONENT)&&!(r.shapeFlag&N.SUSPENSE))return r;let a=L(r);console.log("vnode.key",a.key);const k=K();if(a.el&&(a=E.cloneVNode(a),r.shapeFlag&N.SUSPENSE&&(r.ssContent=a)),A=k,O.action===u.backName){console.log("back");let C=p.pop();const d=p[p.length-1].vnode;a.el=d.el,a.component=d.component,a.transition&&E.setTransitionHooks(a,a.transition),a.shapeFlag|=N.COMPONENT_KEPT_ALIVE,g(C.vnode),C=null,P=!0}return a.shapeFlag|=N.COMPONENT_SHOULD_KEEP_ALIVE,x(r.type)?r:a}}}),B=n=>{const e=n.push.bind(n),c=n.go.bind(n),o=n.replace.bind(n),s=n.back.bind(n),l=n.forward.bind(n);n.push=T=>(O.action=u.pushName,e(T)),n.go=T=>{O.action=u.goName,c(T)},n.replace=T=>(O.action=u.replaceName,o(T)),n.back=()=>{O.action=u.backName,s()},n.forward=()=>{O.action=u.forwardName,l()}},G={install(n,{router:e,backCallback:c,forwardCallback:o}={router:null,backCallback:null,forwardCallback:null}){if(!e)throw Error("router is required");let s=null;e.options.history.listen((l,T,m)=>{s=m}),e.beforeEach(()=>{s&&(s.direction==="back"&&c?c():s.direction==="forward"&&o&&o(),s=null)})}},X=()=>{O.action=u.backName},Y={install(n,{router:e,name:c=u.componentName,keyName:o=u.keyName}){if(!e)throw Error(`
 vue-router is necessary. 

`);n.component(c,W()),n.use(G,{router:e,backCallback:X}),B(e)}};module.exports=Y;
