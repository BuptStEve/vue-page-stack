"use strict";const N=require("vue"),S=require("vue-router"),E={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"};var p;(function(e){e[e.ELEMENT=1]="ELEMENT",e[e.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",e[e.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",e[e.TEXT_CHILDREN=8]="TEXT_CHILDREN",e[e.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",e[e.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",e[e.TELEPORT=64]="TELEPORT",e[e.SUSPENSE=128]="SUSPENSE",e[e.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",e[e.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE",e[e.COMPONENT=6]="COMPONENT"})(p||(p={}));const V=(e,n)=>{for(let r=0;r<e.length;r++)e[r](n)};function h(e,n,r,o){N.callWithAsyncErrorHandling(e,n,K.VNODE_HOOK,[r,o])}const b=e=>e.__isSuspense,I={ENTER:0,LEAVE:1,REORDER:2},K={SETUP_FUNCTION:0,RENDER_FUNCTION:1,WATCH_GETTER:2,WATCH_CALLBACK:3,WATCH_CLEANUP:4,NATIVE_EVENT_HANDLER:5,COMPONENT_EVENT_HANDLER:6,VNODE_HOOK:7};function H(e){e.shapeFlag&=~p.COMPONENT_SHOULD_KEEP_ALIVE,e.shapeFlag&=~p.COMPONENT_KEPT_ALIVE}function L(e){return e.shapeFlag&p.SUSPENSE?e.ssContent:e}const u=[],U=e=>{for(let n=0;n<u.length;n++)if(u[n].key===e)return n;return-1},g=e=>N.defineComponent({name:E.componentName,__isKeepAlive:!0,setup(n,{slots:r}){const o=N.getCurrentInstance(),c=o.ctx,T=o.suspense,{renderer:{p:O,m:A,um:x,o:{createElement:k}}}=c,y=k("div");c.activate=(t,l,_,a,s)=>{const i=t.component;A(t,l,_,I.ENTER,T),O(i.vnode,t,l,_,i,T,a,t.slotScopeIds,s),N.queuePostFlushCb(()=>{i.isDeactivated=!1,i.a&&V(i.a);const C=t.props&&t.props.onVnodeMounted;C&&h(C,i.parent,t)},T)},c.deactivate=t=>{const l=t.component;A(t,y,null,I.LEAVE,T),N.queuePostFlushCb(()=>{l.da&&V(l.da);const _=t.props&&t.props.onVnodeUnmounted;_&&h(_,l.parent,t),l.isDeactivated=!0},T)};function D(t){H(t),x(t,o,T,!0)}let f=null,P=!1;const R=()=>{f!=null&&(P?u[u.length-1].vnode=L(o.subTree):u.push({key:f,vnode:L(o.subTree)}))};return N.onMounted(R),N.onUpdated(R),N.onBeforeUnmount(()=>{for(const t of u)D(t.vnode)}),()=>{f=null,P=!1;const l=S.useRoute().query[e];if(!r.default)return null;const _=r.default(),a=_[0];if(_.length>1)return _;if(!N.isVNode(a)||!(a.shapeFlag&p.STATEFUL_COMPONENT)&&!(a.shapeFlag&p.SUSPENSE))return a;let s=L(a);s.el&&(s=N.cloneVNode(s),a.shapeFlag&p.SUSPENSE&&(a.ssContent=s)),f=l;let i=U(l);if(i!==-1){const C=u[i].vnode;s.el=C.el,s.component=C.component,s.transition&&N.setTransitionHooks(s,s.transition),s.shapeFlag|=p.COMPONENT_KEPT_ALIVE;for(let m=i+1;m<u.length;m++)H(u[m].vnode),u[m]=null;u.splice(i+1),P=!0}return s.shapeFlag|=p.COMPONENT_SHOULD_KEEP_ALIVE,b(a.type)?a:s}}}),d={action:E.pushName},v=e=>{const n=e.push.bind(e),r=e.go.bind(e),o=e.replace.bind(e),c=e.back.bind(e),T=e.forward.bind(e);e.push=O=>(d.action=E.pushName,n(O)),e.go=O=>{d.action=E.goName,r(O)},e.replace=O=>(d.action=E.replaceName,o(O)),e.back=()=>{d.action=E.backName,c()},e.forward=()=>{d.action=E.forwardName,T()}};function M(e,n){return!!e[n]}function q(e){return e.replace(/[xy]/g,n=>{const r=Math.random()*16|0;return(n==="x"?r:r&3|8).toString(16)})}const w={install(e,{router:n,name:r=E.componentName,keyName:o=E.keyName}){if(!n)throw Error(`
 vue-router is necessary. 

`);e.component(r,g(o)),v(n),n.beforeEach((c,T)=>{if(M(c.query,o))U(c.query[o])===-1?c.params[o+"-dir"]=E.forwardName:c.params[o+"-dir"]=E.backName;else{c.query[o]=q("xxxxxxxx");const O=d.action===E.replaceName||!M(T.query,o);return{hash:c.hash,path:c.path,name:c.name,params:c.params,query:c.query,meta:c.meta,replace:O}}})}};module.exports=w;
//# sourceMappingURL=vue-page-stack.cjs.js.map
