"use strict";const N=require("vue"),y=require("vue-router"),a={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"};var p;(function(e){e[e.ELEMENT=1]="ELEMENT",e[e.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",e[e.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",e[e.TEXT_CHILDREN=8]="TEXT_CHILDREN",e[e.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",e[e.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",e[e.TELEPORT=64]="TELEPORT",e[e.SUSPENSE=128]="SUSPENSE",e[e.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",e[e.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE",e[e.COMPONENT=6]="COMPONENT"})(p||(p={}));const h=(e,n)=>{for(let s=0;s<e.length;s++)e[s](n)};function V(e,n,s,o){N.callWithAsyncErrorHandling(e,n,D.VNODE_HOOK,[s,o])}const b=e=>e.__isSuspense,I={ENTER:0,LEAVE:1,REORDER:2},D={SETUP_FUNCTION:0,RENDER_FUNCTION:1,WATCH_GETTER:2,WATCH_CALLBACK:3,WATCH_CLEANUP:4,NATIVE_EVENT_HANDLER:5,COMPONENT_EVENT_HANDLER:6,VNODE_HOOK:7};function S(e){e.shapeFlag&=~p.COMPONENT_SHOULD_KEEP_ALIVE,e.shapeFlag&=~p.COMPONENT_KEPT_ALIVE}function L(e){return e.shapeFlag&p.SUSPENSE?e.ssContent:e}const O=[],M=e=>{for(let n=0;n<O.length;n++)if(O[n].key===e)return n;return-1},K=e=>N.defineComponent({name:a.componentName,__isKeepAlive:!0,setup(n,{slots:s}){const o=N.getCurrentInstance(),c=o.ctx,u=o.suspense,{renderer:{p:l,m:A,um:U,o:{createElement:g}}}=c,k=g("div");c.activate=(t,T,_,E,r)=>{const i=t.component;A(t,T,_,I.ENTER,u),l(i.vnode,t,T,_,i,u,E,t.slotScopeIds,r),N.queuePostFlushCb(()=>{i.isDeactivated=!1,i.a&&h(i.a);const f=t.props&&t.props.onVnodeMounted;f&&V(f,i.parent,t)},u)},c.deactivate=t=>{const T=t.component;A(t,k,null,I.LEAVE,u),N.queuePostFlushCb(()=>{T.da&&h(T.da);const _=t.props&&t.props.onVnodeUnmounted;_&&V(_,T.parent,t),T.isDeactivated=!0},u)};function x(t){S(t),U(t,o,u,!0)}let C=null,m=!1;const R=()=>{C!=null&&(m?O[O.length-1].vnode=L(o.subTree):O.push({key:C,vnode:L(o.subTree)}))};return N.onMounted(R),N.onUpdated(R),N.onBeforeUnmount(()=>{for(const t of O)x(t.vnode)}),()=>{C=null,m=!1;const T=y.useRoute().query[e];if(!s.default)return null;const _=s.default(),E=_[0];if(_.length>1)return _;if(!N.isVNode(E)||!(E.shapeFlag&p.STATEFUL_COMPONENT)&&!(E.shapeFlag&p.SUSPENSE))return E;let r=L(E);r.el&&(r=N.cloneVNode(r),E.shapeFlag&p.SUSPENSE&&(E.ssContent=r)),C=T;let i=M(T);if(i!==-1){const f=O[i].vnode;r.el=f.el,r.component=f.component,r.transition&&N.setTransitionHooks(r,r.transition),r.shapeFlag|=p.COMPONENT_KEPT_ALIVE;for(let P=i+1;P<O.length;P++)O[P]=null;O.splice(i+1),m=!0}return r.shapeFlag|=p.COMPONENT_SHOULD_KEEP_ALIVE,b(E.type)?E:r}}}),d={action:a.pushName},q=e=>{const n=e.push.bind(e),s=e.go.bind(e),o=e.replace.bind(e),c=e.back.bind(e),u=e.forward.bind(e);e.push=l=>(d.action=a.pushName,console.log("push"),n(l)),e.go=l=>{d.action=a.goName,console.log("go"),s(l)},e.replace=l=>(d.action=a.replaceName,console.log("replace"),o(l)),e.back=()=>{d.action=a.backName,console.log("back"),c()},e.forward=()=>{d.action=a.forwardName,console.log("forward"),u()}};function H(e,n){return!!e[n]}function v(e){return e.replace(/[xy]/g,n=>{const s=Math.random()*16|0;return(n==="x"?s:s&3|8).toString(16)})}const w={install(e,{router:n,name:s=a.componentName,keyName:o=a.keyName}){if(!n)throw Error(`
 vue-router is necessary. 

`);e.component(s,K(o)),q(n),n.beforeEach((c,u)=>{if(H(c.query,o))M(c.query[o])===-1?c.params[o+"-dir"]=a.forwardName:c.params[o+"-dir"]=a.backName;else{c.query[o]=v("xxxxxxxx");const l=d.action===a.replaceName||!H(u.query,o);return{hash:c.hash,path:c.path,name:c.name,params:c.params,query:c.query,meta:c.meta,replace:l}}})}};module.exports=w;
//# sourceMappingURL=vue-page-stack.cjs.js.map
