"use strict";const l=require("vue"),u={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"},O={action:u.pushName};let g;const D=new Uint8Array(16);function M(){if(!g&&(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!g))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(D)}const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function F(e,n=0){return i[e[n+0]]+i[e[n+1]]+i[e[n+2]]+i[e[n+3]]+"-"+i[e[n+4]]+i[e[n+5]]+"-"+i[e[n+6]]+i[e[n+7]]+"-"+i[e[n+8]]+i[e[n+9]]+"-"+i[e[n+10]]+i[e[n+11]]+i[e[n+12]]+i[e[n+13]]+i[e[n+14]]+i[e[n+15]]}const H=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),L={randomUUID:H};function w(e,n,t){if(L.randomUUID&&!n&&!e)return L.randomUUID();e=e||{};const s=e.random||(e.rng||M)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,n){t=t||0;for(let a=0;a<16;++a)n[t+a]=s[a];return n}return F(s)}/**
* @vue/shared v3.4.19
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/process.env.NODE_ENV!=="production"&&Object.freeze({});process.env.NODE_ENV!=="production"&&Object.freeze([]);const U=(e,n)=>{for(let t=0;t<e.length;t++)e[t](n)},d={ELEMENT:1,1:"ELEMENT",FUNCTIONAL_COMPONENT:2,2:"FUNCTIONAL_COMPONENT",STATEFUL_COMPONENT:4,4:"STATEFUL_COMPONENT",TEXT_CHILDREN:8,8:"TEXT_CHILDREN",ARRAY_CHILDREN:16,16:"ARRAY_CHILDREN",SLOTS_CHILDREN:32,32:"SLOTS_CHILDREN",TELEPORT:64,64:"TELEPORT",SUSPENSE:128,128:"SUSPENSE",COMPONENT_SHOULD_KEEP_ALIVE:256,256:"COMPONENT_SHOULD_KEEP_ALIVE",COMPONENT_KEPT_ALIVE:512,512:"COMPONENT_KEPT_ALIVE",COMPONENT:6,6:"COMPONENT"};function y(e,n,t,s){l.callWithAsyncErrorHandling(e,n,l.ErrorCodes.VNODE_HOOK,[t,s])}const v=e=>e.__isSuspense,V={ENTER:0,LEAVE:1,REORDER:2};function I(e){e.shapeFlag&=~d.COMPONENT_SHOULD_KEEP_ALIVE,e.shapeFlag&=~d.COMPONENT_KEPT_ALIVE}function _(e){return e.shapeFlag&d.SUSPENSE?e.ssContent:e}const N=[],K=()=>l.defineComponent({name:u.componentName,__isKeepAlive:!0,setup(e,{slots:n}){const t=l.getCurrentInstance(),s=t.ctx,a=t.suspense,{renderer:{p:m,m:E,um:h,o:{createElement:A}}}=s,R=A("div");s.activate=(o,r,c,C,T)=>{const p=o.component;E(o,r,c,V.ENTER,a),m(p.vnode,o,r,c,p,a,C,o.slotScopeIds,T),l.queuePostFlushCb(()=>{p.isDeactivated=!1,p.a&&U(p.a);const b=o.props&&o.props.onVnodeMounted;b&&y(b,p.parent,o)},a)},s.deactivate=o=>{const r=o.component;E(o,R,null,V.LEAVE,a),l.queuePostFlushCb(()=>{r.da&&U(r.da);const c=o.props&&o.props.onVnodeUnmounted;c&&y(c,r.parent,o),r.isDeactivated=!0},a)};function f(o){I(o),h(o,t,a,!0)}let P=null,S=!1;const k=()=>{P&&(S?N[N.length-1].vnode=_(t.subTree):(console.log("cacheSubtree and push"),N.push({vnode:_(t.subTree)}),console.log(N)))};return l.onMounted(k),l.onUpdated(k),l.onBeforeUnmount(()=>{for(const o of N)f(o.vnode)}),()=>{if(S=!1,!n.default)return null;const o=n.default(),r=o[0];if(o.length>1)return o;if(!l.isVNode(r)||!(r.shapeFlag&d.STATEFUL_COMPONENT)&&!(r.shapeFlag&d.SUSPENSE))return r;let c=_(r);console.log("vnode.key",c.key);const C=w();if(c.el&&(c=l.cloneVNode(c),r.shapeFlag&d.SUSPENSE&&(r.ssContent=c)),P=C,O.action===u.backName){console.log("back");let T=N.pop();const p=N[N.length-1].vnode;c.el=p.el,c.component=p.component,c.transition&&l.setTransitionHooks(c,c.transition),c.shapeFlag|=d.COMPONENT_KEPT_ALIVE,I(T.vnode),T=null,S=!0}return c.shapeFlag|=d.COMPONENT_SHOULD_KEEP_ALIVE,v(r.type)?r:c}}}),x=e=>{const n=e.push.bind(e),t=e.go.bind(e),s=e.replace.bind(e),a=e.back.bind(e),m=e.forward.bind(e);e.push=E=>(O.action=u.pushName,n(E)),e.go=E=>{O.action=u.goName,t(E)},e.replace=E=>(O.action=u.replaceName,s(E)),e.back=()=>{O.action=u.backName,a()},e.forward=()=>{O.action=u.forwardName,m()}},q={install(e,{router:n,backCallback:t,forwardCallback:s}={router:null,backCallback:null,forwardCallback:null}){if(!n)throw Error("router is required");let a=null;n.options.history.listen((m,E,h)=>{a=h}),n.beforeEach(()=>{a&&(a.direction==="back"&&t?t():a.direction==="forward"&&s&&s(),a=null)})}},j=()=>{O.action=u.backName},z={install(e,{router:n,name:t=u.componentName}){if(!n)throw Error(`
 vue-router is necessary. 

`);e.component(t,K()),e.use(q,{router:n,backCallback:j}),x(n)}};module.exports=z;
