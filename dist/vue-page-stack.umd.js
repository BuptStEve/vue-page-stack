(function(r,_){typeof exports=="object"&&typeof module<"u"?module.exports=_(require("vue"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","vue-router"],_):(r=typeof globalThis<"u"?globalThis:r||self,r.VuePageStack=_(r.Vue,r.vueRouter))})(this,function(r,_){"use strict";const i={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"};var T;(function(e){e[e.ELEMENT=1]="ELEMENT",e[e.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",e[e.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",e[e.TEXT_CHILDREN=8]="TEXT_CHILDREN",e[e.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",e[e.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",e[e.TELEPORT=64]="TELEPORT",e[e.SUSPENSE=128]="SUSPENSE",e[e.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",e[e.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE",e[e.COMPONENT=6]="COMPONENT"})(T||(T={}));const V=(e,n)=>{for(let s=0;s<e.length;s++)e[s](n)};function h(e,n,s,o){r.callWithAsyncErrorHandling(e,n,U.VNODE_HOOK,[s,o])}const y=e=>e.__isSuspense,R={ENTER:0,LEAVE:1,REORDER:2},U={SETUP_FUNCTION:0,RENDER_FUNCTION:1,WATCH_GETTER:2,WATCH_CALLBACK:3,WATCH_CLEANUP:4,NATIVE_EVENT_HANDLER:5,COMPONENT_EVENT_HANDLER:6,VNODE_HOOK:7};function S(e){e.shapeFlag&=~T.COMPONENT_SHOULD_KEEP_ALIVE,e.shapeFlag&=~T.COMPONENT_KEPT_ALIVE}function L(e){return e.shapeFlag&T.SUSPENSE?e.ssContent:e}const a=[],I=e=>{for(let n=0;n<a.length;n++)if(a[n].key===e)return n;return-1},D=e=>r.defineComponent({name:i.componentName,__isKeepAlive:!0,setup(n,{slots:s}){const o=r.getCurrentInstance(),c=o.ctx,d=o.suspense,{renderer:{p:f,m:M,um:g,o:{createElement:q}}}=c,w=q("div");c.activate=(t,p,O,u,E)=>{const N=t.component;M(t,p,O,R.ENTER,d),f(N.vnode,t,p,O,N,d,u,t.slotScopeIds,E),r.queuePostFlushCb(()=>{N.isDeactivated=!1,N.a&&V(N.a);const C=t.props&&t.props.onVnodeMounted;C&&h(C,N.parent,t)},d)},c.deactivate=t=>{const p=t.component;M(t,w,null,R.LEAVE,d),r.queuePostFlushCb(()=>{p.da&&V(p.da);const O=t.props&&t.props.onVnodeUnmounted;O&&h(O,p.parent,t),p.isDeactivated=!0},d)};function k(t){S(t),g(t,o,d,!0)}let m=null,A=!1;const x=()=>{m!=null&&(A?a[a.length-1].vnode=L(o.subTree):a.push({key:m,vnode:L(o.subTree)}))};return r.onMounted(x),r.onUpdated(x),r.onBeforeUnmount(()=>{for(const t of a)k(t.vnode)}),()=>{m=null,A=!1;const p=_.useRoute().query[e];if(!s.default)return null;const O=s.default(),u=O[0];if(O.length>1)return O;if(!r.isVNode(u)||!(u.shapeFlag&T.STATEFUL_COMPONENT)&&!(u.shapeFlag&T.SUSPENSE))return u;let E=L(u);E.el&&(E=r.cloneVNode(E),u.shapeFlag&T.SUSPENSE&&(u.ssContent=E)),m=p;let N=I(p);if(N!==-1){const C=a[N].vnode;E.el=C.el,E.component=C.component,E.transition&&r.setTransitionHooks(E,E.transition),E.shapeFlag|=T.COMPONENT_KEPT_ALIVE;for(let P=N+1;P<a.length;P++)k(a[P].vnode),a[P]=null;a.splice(N+1),A=!0}return E.shapeFlag|=T.COMPONENT_SHOULD_KEEP_ALIVE,y(u.type)?u:E}}}),l={action:i.pushName},b=e=>{const n=e.push.bind(e),s=e.go.bind(e),o=e.replace.bind(e),c=e.back.bind(e),d=e.forward.bind(e);e.push=f=>(l.action=i.pushName,n(f)),e.go=f=>{l.action=i.goName,s(f)},e.replace=f=>(l.action=i.replaceName,o(f)),e.back=()=>{l.action=i.backName,c()},e.forward=()=>{l.action=i.forwardName,d()}};function H(e,n){return!!e[n]}function K(e){return e.replace(/[xy]/g,n=>{const s=Math.random()*16|0;return(n==="x"?s:s&3|8).toString(16)})}return{install(e,{router:n,name:s=i.componentName,keyName:o=i.keyName}){if(!n)throw Error(`
 vue-router is necessary. 

`);e.component(s,D(o)),b(n),n.beforeEach((c,d)=>{if(H(c.query,o))I(c.query[o])===-1?c.params[o+"-dir"]=i.forwardName:c.params[o+"-dir"]=i.backName;else{c.query[o]=K("xxxxxxxx");const f=l.action===i.replaceName||!H(d.query,o);return{hash:c.hash,path:c.path,name:c.name,params:c.params,query:c.query,meta:c.meta,replace:f}}})}}});
//# sourceMappingURL=vue-page-stack.umd.js.map
