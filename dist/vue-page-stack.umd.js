(function(c,_){typeof exports=="object"&&typeof module<"u"?module.exports=_(require("vue"),require("vue-router")):typeof define=="function"&&define.amd?define(["vue","vue-router"],_):(c=typeof globalThis<"u"?globalThis:c||self,c.VuePageStack=_(c.Vue,c.vueRouter))})(this,function(c,_){"use strict";const E={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"};var N;(function(e){e[e.ELEMENT=1]="ELEMENT",e[e.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",e[e.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",e[e.TEXT_CHILDREN=8]="TEXT_CHILDREN",e[e.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",e[e.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",e[e.TELEPORT=64]="TELEPORT",e[e.SUSPENSE=128]="SUSPENSE",e[e.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",e[e.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE",e[e.COMPONENT=6]="COMPONENT"})(N||(N={}));const h=(e,n)=>{for(let r=0;r<e.length;r++)e[r](n)};function V(e,n,r,o){c.callWithAsyncErrorHandling(e,n,x.VNODE_HOOK,[r,o])}const g=e=>e.__isSuspense,R={ENTER:0,LEAVE:1,REORDER:2},x={SETUP_FUNCTION:0,RENDER_FUNCTION:1,WATCH_GETTER:2,WATCH_CALLBACK:3,WATCH_CLEANUP:4,NATIVE_EVENT_HANDLER:5,COMPONENT_EVENT_HANDLER:6,VNODE_HOOK:7};function y(e){e.shapeFlag&=~N.COMPONENT_SHOULD_KEEP_ALIVE,e.shapeFlag&=~N.COMPONENT_KEPT_ALIVE}function P(e){return e.shapeFlag&N.SUSPENSE?e.ssContent:e}const l=[],I=e=>{for(let n=0;n<l.length;n++)if(l[n].key===e)return n;return-1},U=e=>c.defineComponent({name:E.componentName,__isKeepAlive:!0,setup(n,{slots:r}){const o=c.getCurrentInstance(),s=o.ctx,T=o.suspense,{renderer:{p:d,m:H,um:b,o:{createElement:K}}}=s,q=K("div");s.activate=(t,f,p,i,a)=>{const u=t.component;H(t,f,p,R.ENTER,T),d(u.vnode,t,f,p,u,T,i,t.slotScopeIds,a),c.queuePostFlushCb(()=>{u.isDeactivated=!1,u.a&&h(u.a);const C=t.props&&t.props.onVnodeMounted;C&&V(C,u.parent,t)},T)},s.deactivate=t=>{const f=t.component;H(t,q,null,R.LEAVE,T),c.queuePostFlushCb(()=>{f.da&&h(f.da);const p=t.props&&t.props.onVnodeUnmounted;p&&V(p,f.parent,t),f.isDeactivated=!0},T)};function w(t){y(t),b(t,o,T,!0)}let m=null,L=!1;const M=()=>{m!=null&&(L?l[l.length-1].vnode=P(o.subTree):l.push({key:m,vnode:P(o.subTree)}))};return c.onMounted(M),c.onUpdated(M),c.onBeforeUnmount(()=>{for(const t of l)w(t.vnode)}),()=>{m=null,L=!1;const f=_.useRoute().query[e];if(!r.default)return null;const p=r.default(),i=p[0];if(p.length>1)return p;if(!c.isVNode(i)||!(i.shapeFlag&N.STATEFUL_COMPONENT)&&!(i.shapeFlag&N.SUSPENSE))return i;let a=P(i);a.el&&(a=c.cloneVNode(a),i.shapeFlag&N.SUSPENSE&&(i.ssContent=a)),m=f;let u=I(f);if(u!==-1){const C=l[u].vnode;a.el=C.el,a.component=C.component,a.transition&&c.setTransitionHooks(a,a.transition),a.shapeFlag|=N.COMPONENT_KEPT_ALIVE;for(let A=u+1;A<l.length;A++)l[A]=null;l.splice(u+1),L=!0}return a.shapeFlag|=N.COMPONENT_SHOULD_KEEP_ALIVE,g(i.type)?i:a}}}),O={action:E.pushName},S=e=>{const n=e.push.bind(e),r=e.go.bind(e),o=e.replace.bind(e),s=e.back.bind(e),T=e.forward.bind(e);e.push=d=>(O.action=E.pushName,console.log("push"),n(d)),e.go=d=>{O.action=E.goName,console.log("go"),r(d)},e.replace=d=>(O.action=E.replaceName,console.log("replace"),o(d)),e.back=()=>{O.action=E.backName,console.log("back"),s()},e.forward=()=>{O.action=E.forwardName,console.log("forward"),T()}};function k(e,n){return!!e[n]}function D(e){return e.replace(/[xy]/g,n=>{const r=Math.random()*16|0;return(n==="x"?r:r&3|8).toString(16)})}return{install(e,{router:n,name:r=E.componentName,keyName:o=E.keyName}){if(!n)throw Error(`
 vue-router is necessary. 

`);e.component(r,U(o)),S(n),n.beforeEach((s,T)=>{if(k(s.query,o))I(s.query[o])===-1?s.params[o+"-dir"]=E.forwardName:s.params[o+"-dir"]=E.backName;else{s.query[o]=D("xxxxxxxx");const d=O.action===E.replaceName||!k(T.query,o);return{hash:s.hash,path:s.path,name:s.name,params:s.params,query:s.query,meta:s.meta,replace:d}}})}}});
//# sourceMappingURL=vue-page-stack.umd.js.map
