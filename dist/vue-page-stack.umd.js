(function(s,u){typeof exports=="object"&&typeof module<"u"?module.exports=u(require("vue")):typeof define=="function"&&define.amd?define(["vue"],u):(s=typeof globalThis<"u"?globalThis:s||self,s.VuePageStack=u(s.Vue))})(this,function(s){"use strict";const u={componentName:"VuePageStack",keyName:"stack-key",pushName:"push",goName:"go",replaceName:"replace",backName:"back",forwardName:"forward"},m={action:u.pushName};let O;const I=new Uint8Array(16);function A(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(I)}const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function R(e,n=0){return i[e[n+0]]+i[e[n+1]]+i[e[n+2]]+i[e[n+3]]+"-"+i[e[n+4]]+i[e[n+5]]+"-"+i[e[n+6]]+i[e[n+7]]+"-"+i[e[n+8]]+i[e[n+9]]+"-"+i[e[n+10]]+i[e[n+11]]+i[e[n+12]]+i[e[n+13]]+i[e[n+14]]+i[e[n+15]]}const _={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function D(e,n,t){if(_.randomUUID&&!n&&!e)return _.randomUUID();e=e||{};const r=e.random||(e.rng||A)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){t=t||0;for(let a=0;a<16;++a)n[t+a]=r[a];return n}return R(r)}/**
* @vue/shared v3.4.19
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/process.env.NODE_ENV!=="production"&&Object.freeze({}),process.env.NODE_ENV!=="production"&&Object.freeze([]);const k=(e,n)=>{for(let t=0;t<e.length;t++)e[t](n)},d={ELEMENT:1,1:"ELEMENT",FUNCTIONAL_COMPONENT:2,2:"FUNCTIONAL_COMPONENT",STATEFUL_COMPONENT:4,4:"STATEFUL_COMPONENT",TEXT_CHILDREN:8,8:"TEXT_CHILDREN",ARRAY_CHILDREN:16,16:"ARRAY_CHILDREN",SLOTS_CHILDREN:32,32:"SLOTS_CHILDREN",TELEPORT:64,64:"TELEPORT",SUSPENSE:128,128:"SUSPENSE",COMPONENT_SHOULD_KEEP_ALIVE:256,256:"COMPONENT_SHOULD_KEEP_ALIVE",COMPONENT_KEPT_ALIVE:512,512:"COMPONENT_KEPT_ALIVE",COMPONENT:6,6:"COMPONENT"};function b(e,n,t,r){s.callWithAsyncErrorHandling(e,n,s.ErrorCodes.VNODE_HOOK,[t,r])}const M=e=>e.__isSuspense,f={ENTER:0,LEAVE:1,REORDER:2};function L(e){e.shapeFlag&=~d.COMPONENT_SHOULD_KEEP_ALIVE,e.shapeFlag&=~d.COMPONENT_KEPT_ALIVE}function g(e){return e.shapeFlag&d.SUSPENSE?e.ssContent:e}const N=[],F=()=>s.defineComponent({name:u.componentName,__isKeepAlive:!0,setup(e,{slots:n}){const t=s.getCurrentInstance(),r=t.ctx,a=t.suspense,{renderer:{p:T,m:E,um:S,o:{createElement:x}}}=r,j=x("div");r.activate=(o,l,c,P,h)=>{const p=o.component;E(o,l,c,f.ENTER,a),T(p.vnode,o,l,c,p,a,P,o.slotScopeIds,h),s.queuePostFlushCb(()=>{p.isDeactivated=!1,p.a&&k(p.a);const y=o.props&&o.props.onVnodeMounted;y&&b(y,p.parent,o)},a)},r.deactivate=o=>{const l=o.component;E(o,j,null,f.LEAVE,a),s.queuePostFlushCb(()=>{l.da&&k(l.da);const c=o.props&&o.props.onVnodeUnmounted;c&&b(c,l.parent,o),l.isDeactivated=!0},a)};function q(o){L(o),S(o,t,a,!0)}let U=null,C=!1;const V=()=>{U&&(C?N[N.length-1].vnode=g(t.subTree):(console.log("cacheSubtree and push"),N.push({vnode:g(t.subTree)}),console.log(N)))};return s.onMounted(V),s.onUpdated(V),s.onBeforeUnmount(()=>{for(const o of N)q(o.vnode)}),()=>{if(C=!1,!n.default)return null;const o=n.default(),l=o[0];if(o.length>1)return o;if(!s.isVNode(l)||!(l.shapeFlag&d.STATEFUL_COMPONENT)&&!(l.shapeFlag&d.SUSPENSE))return l;let c=g(l);console.log("vnode.key",c.key);const P=D();if(c.el&&(c=s.cloneVNode(c),l.shapeFlag&d.SUSPENSE&&(l.ssContent=c)),U=P,m.action===u.backName){console.log("back");let h=N.pop();const p=N[N.length-1].vnode;c.el=p.el,c.component=p.component,c.transition&&s.setTransitionHooks(c,c.transition),c.shapeFlag|=d.COMPONENT_KEPT_ALIVE,L(h.vnode),h=null,C=!0}return c.shapeFlag|=d.COMPONENT_SHOULD_KEEP_ALIVE,M(l.type)?l:c}}}),H=e=>{const n=e.push.bind(e),t=e.go.bind(e),r=e.replace.bind(e),a=e.back.bind(e),T=e.forward.bind(e);e.push=E=>(m.action=u.pushName,n(E)),e.go=E=>{m.action=u.goName,t(E)},e.replace=E=>(m.action=u.replaceName,r(E)),e.back=()=>{m.action=u.backName,a()},e.forward=()=>{m.action=u.forwardName,T()}},w={install(e,{router:n,backCallback:t,forwardCallback:r}={router:null,backCallback:null,forwardCallback:null}){if(!n)throw Error("router is required");let a=null;n.options.history.listen((T,E,S)=>{a=S}),n.beforeEach(()=>{a&&(a.direction==="back"&&t?t():a.direction==="forward"&&r&&r(),a=null)})}},K=()=>{m.action=u.backName};return{install(e,{router:n,name:t=u.componentName}){if(!n)throw Error(`
 vue-router is necessary. 

`);e.component(t,F()),e.use(w,{router:n,backCallback:K}),H(n)}}});
