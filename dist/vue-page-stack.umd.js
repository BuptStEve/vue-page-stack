!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).VuePageStack=n()}(this,(function(){"use strict";const e="VuePageStack",n="stack-key",t="push",o="go",r="replace",a="back",c="forward",s={action:t};function i(e){return null!=e}const u=[];function p(e){for(let n=0;n<u.length;n++)if(u[n].key===e)return n;return-1}const f=n=>({name:e,abstract:!0,data:()=>({}),props:{max:{type:[String,Number],default:()=>""}},render(){const e=this.$route.query[n],t=function(e){if(Array.isArray(e))for(const t of e)if(i(t)&&(i(t.componentOptions)||(n=t).isComment&&n.asyncFactory))return t;var n}(this.$slots.default);if(!t)return t;const o=p(e);if(-1!==o){t.componentInstance=u[o].vnode.componentInstance;for(let e=o+1;e<u.length;e++)u[e].vnode.componentInstance.$destroy(),u[e]=null;u.splice(o+1)}else s.action===r&&(u[u.length-1].vnode.componentInstance.$destroy(),u[u.length-1]=null,u.splice(u.length-1)),u.push({key:e,vnode:t});return t.data.keepAlive=!0,t}});function l(){return u}function d(e,n){return!!e[n]}return{install(i,{router:u,name:m=e,keyName:h=n}){if(!u)throw Error("\n vue-router is necessary. \n\n");i.component(m,f(h)),i.prototype.$pageStack={getStack:l},(e=>{const n=e.push.bind(e),i=e.go.bind(e),u=e.replace.bind(e),p=e.back.bind(e),f=e.forward.bind(e);e.push=(e,o,r)=>(s.action=t,o||r?n(e,o,r):n(e).catch((e=>e))),e.go=e=>{s.action=o,i(e)},e.replace=(e,n,t)=>(s.action=r,n||t?u(e,n,t):u(e).catch((e=>e))),e.back=()=>{s.action=a,p()},e.forward=()=>{s.action=c,f()}})(u),u.beforeHooks.unshift((function(e,n,t){if(d(e.query,h)){const n=p(e.query[h]);e.params[h+"-dir"]=-1===n?c:a,t({params:e.params})}else{e.query[h]="xxxxxxxx".replace(/[xy]/g,(e=>{const n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)}));const o=s.action===r||!d(n.query,h);t({hash:e.hash,path:e.path,name:e.name,params:e.params,query:e.query,meta:e.meta,replace:o})}}))}}}));
