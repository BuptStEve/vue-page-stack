const n="VuePageStack",e="stack-key",t="push",r="go",a="replace",o="back",c="forward",s={action:t};function i(n){return null!=n}const u=[];function p(n){for(let e=0;e<u.length;e++)if(u[e].key===n)return e;return-1}const l=e=>({name:n,abstract:!0,data:()=>({}),props:{max:{type:[String,Number],default:()=>""}},render(){const n=this.$route.query[e],t=function(n){if(Array.isArray(n))for(const t of n)if(i(t)&&(i(t.componentOptions)||(e=t).isComment&&e.asyncFactory))return t;var e}(this.$slots.default);if(!t)return t;const r=p(n);if(-1!==r){t.componentInstance=u[r].vnode.componentInstance;for(let n=r+1;n<u.length;n++)u[n].vnode.componentInstance.$destroy(),u[n]=null;u.splice(r+1)}else s.action===a&&(u[u.length-1].vnode.componentInstance.$destroy(),u[u.length-1]=null,u.splice(u.length-1)),u.push({key:n,vnode:t});return t.data.keepAlive=!0,t}});function f(){return u}function m(n,e){return!!n[e]}const d={install(i,{router:u,name:d=n,keyName:h=e}){if(!u)throw Error("\n vue-router is necessary. \n\n");i.component(d,l(h)),i.prototype.$pageStack={getStack:f},(n=>{const e=n.push.bind(n),i=n.go.bind(n),u=n.replace.bind(n),p=n.back.bind(n),l=n.forward.bind(n);n.push=(n,r,a)=>(s.action=t,r||a?e(n,r,a):e(n).catch((n=>n))),n.go=n=>{s.action=r,i(n)},n.replace=(n,e,t)=>(s.action=a,e||t?u(n,e,t):u(n).catch((n=>n))),n.back=()=>{s.action=o,p()},n.forward=()=>{s.action=c,l()}})(u),u.beforeHooks.unshift((function(n,e,t){if(m(n.query,h)){const e=p(n.query[h]);n.params[h+"-dir"]=-1===e?c:o,t({params:n.params})}else{n.query[h]="xxxxxxxx".replace(/[xy]/g,(n=>{const e=16*Math.random()|0;return("x"===n?e:3&e|8).toString(16)}));const r=s.action===a||!m(e.query,h);t({hash:n.hash,path:n.path,name:n.name,params:n.params,query:n.query,meta:n.meta,replace:r})}}))}};export default d;
